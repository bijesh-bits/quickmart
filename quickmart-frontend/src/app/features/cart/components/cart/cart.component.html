<div class="cart-container">
  <h1 class="cart-header">Shopping Cart</h1>

  <!-- Loading State -->
  <div *ngIf="loading" class="text-center py-6">
    <p-progressSpinner></p-progressSpinner>
    <p class="mt-2">Loading your cart...</p>
  </div>

  <!-- Empty Cart -->
  <div *ngIf="!loading && (!cart || cart.items.length === 0)" class="empty-cart-message">
    <i class="pi pi-shopping-cart"></i>
    <h2>Your Cart is Empty</h2>
    <p>Looks like you haven't added anything to your cart yet.</p>
    <button pButton type="button" label="Continue Shopping" icon="pi pi-arrow-left" (click)="continueShopping()"></button>
  </div>

  <!-- Cart with Items -->
  <div *ngIf="!loading && cart && cart.items.length > 0" class="grid">
    <!-- Cart Items -->
    <div class="col-12 lg:col-8">
      <div class="flex justify-content-between align-items-center mb-4">
        <h3 class="m-0 font-semibold">{{ cart.items.length }} items in your cart</h3>
        <button pButton type="button" label="Clear Cart" icon="pi pi-trash" class="p-button-danger p-button-text" (click)="clearCart()"></button>
      </div>

      <div *ngFor="let item of cart.items" class="cart-item-card">
        <img [src]="imageUrls[item.productId]" (error)="handleImageError($event)" [alt]="item.productName" class="product-image">
        
        <div class="item-details">
          <p class="product-name">{{ item.productName }}</p>
          <span *ngIf="item.stockQuantity !== undefined" class="stock-status" [ngClass]="{'in-stock': item.stockQuantity > 0, 'out-of-stock': item.stockQuantity === 0}">
            {{ item.stockQuantity > 0 ? 'In Stock' : 'Out of Stock' }}
          </span>
        </div>

        <div class="item-actions">
          <div class="unit-price">{{ item.unitPrice | currency:'INR' }}</div>
          <p-inputNumber 
            [(ngModel)]="item.quantity" 
            [showButtons]="true" 
            [min]="1" 
            [max]="item.stockQuantity" 
            (onBlur)="updateQuantity(item, item.quantity)"
            [disabled]="updatingItem === item.cartItemId"
            buttonLayout="horizontal" 
            incrementButtonIcon="pi pi-plus" 
            decrementButtonIcon="pi pi-minus">
          </p-inputNumber>
          <div class="subtotal">{{ item.subtotal | currency:'INR' }}</div>
          <button pButton type="button" icon="pi pi-times" class="p-button-rounded p-button-text p-button-danger" (click)="removeItem(item)"></button>
        </div>
      </div>
    </div>

    <!-- Order Summary -->
    <div class="col-12 lg:col-4">
      <div class="summary-card">
        <h3 class="mb-4 font-semibold">Order Summary</h3>
        <div class="summary-item">
          <span>Subtotal</span>
          <span>{{ cart.totalPrice | currency:'INR' }}</span>
        </div>
        <div class="summary-item">
          <span>Shipping</span>
          <span>FREE</span>
        </div>
        <div class="summary-total">
          <span>Total</span>
          <span>{{ cart.totalPrice | currency:'INR' }}</span>
        </div>
        <button pButton type="button" label="Proceed to Checkout" icon="pi pi-credit-card" styleClass="w-full mt-4 p-button-lg" (click)="checkout()"></button>
      </div>
    </div>
  </div>
</div>
