<div class="orders-page">
  <div class="header">
    <h1 class="text-900 font-bold text-3xl">My Orders</h1>
    <p-button 
      label="Continue Shopping" 
      icon="pi pi-shopping-cart"
      styleClass="p-button-outlined"
      (onClick)="continueShopping()">
    </p-button>
  </div>

  <!-- Loading State -->
  <div *ngIf="loading" class="loading-container">
    <p-progressSpinner strokeWidth="4"></p-progressSpinner>
    <p class="mt-3 text-lg">Loading your orders...</p>
  </div>

  <!-- Empty Orders -->
  <div *ngIf="!loading && orders.length === 0" class="empty-orders-container">
    <div class="icon-container">
      <i class="pi pi-inbox"></i>
    </div>
    <h2 class="text-900 font-bold text-2xl mt-4">No orders found</h2>
    <p class="text-600 mb-4">You haven't placed any orders yet. When you do, they'll show up here.</p>
  </div>

  <!-- Orders List -->
  <div *ngIf="!loading && orders.length > 0" class="orders-grid">
    <div *ngFor="let order of orders" class="order-card">
      <div class="order-card-header">
        <div class="order-id">
          <span class="font-bold">Order #{{ order.orderId }}</span>
          <p-tag 
            [value]="order.status" 
            [severity]="getStatusSeverity(order.status)"
            [rounded]="true">
          </p-tag>
        </div>
        <div class="order-date text-sm text-600">
          Placed on {{ formatDate(order.orderDate) }}
        </div>
      </div>
      
      <div class="order-card-body">
        <div class="order-summary">
          <div class="summary-item">
            <span class="text-600">Items</span>
            <span class="font-semibold text-right">{{ order.items.length }}</span>
          </div>
          <div class="summary-item">
            <span class="text-600">Payment</span>
            <p-tag 
              *ngIf="order.payment"
              [value]="order.payment.paymentStatus" 
              [severity]="getPaymentStatusSeverity(order.payment.paymentStatus)"
              styleClass="p-tag-sm">
            </p-tag>
            <span *ngIf="!order.payment" class="text-500 text-sm">N/A</span>
          </div>
        </div>
      </div>

      <div class="order-card-footer">
        <div class="total-amount">
          <span class="text-sm text-600">Total</span>
          <span class="font-bold text-xl">{{ order.totalAmount | currency:'INR' }}</span>
        </div>
        <p-button 
          label="View Details" 
          icon="pi pi-arrow-right"
          iconPos="right"
          styleClass="p-button-text"
          (onClick)="viewOrderDetail(order)">
        </p-button>
      </div>
    </div>
  </div>
</div>

<!-- Order Detail Dialog -->
<p-dialog 
  [(visible)]="displayOrderDetail" 
  [modal]="true"
  [style]="{width: '60vw'}"
  [breakpoints]="{'960px': '80vw', '640px': '95vw'}"
  header="Order Details"
  styleClass="order-dialog"
  *ngIf="selectedOrder">
  
  <div class="order-details-content">
    <div class="grid mb-3">
      <div class="col-12 md:col-6">
        <div class="detail-item">
          <span class="label">Order ID</span>
          <span class="value font-bold">#{{ selectedOrder.orderId }}</span>
        </div>
      </div>
      <div class="col-12 md:col-6">
        <div class="detail-item">
          <span class="label">Order Date</span>
          <span class="value">{{ formatDate(selectedOrder.orderDate) }}</span>
        </div>
      </div>
      <div class="col-12 md:col-6">
        <div class="detail-item">
          <span class="label">Status</span>
          <p-tag [value]="selectedOrder.status" [severity]="getStatusSeverity(selectedOrder.status)"></p-tag>
        </div>
      </div>
      <div class="col-12 md:col-6" *ngIf="selectedOrder.payment">
        <div class="detail-item">
          <span class="label">Payment Status</span>
          <p-tag [value]="selectedOrder.payment.paymentStatus" [severity]="getPaymentStatusSeverity(selectedOrder.payment.paymentStatus)"></p-tag>
        </div>
      </div>
    </div>

    <p-divider></p-divider>

    <div class="grid mt-3">
      <div class="col-12 md:col-6">
        <h4 class="section-title">Shipping Address</h4>
        <div class="address-box">
          {{ selectedOrder.shippingAddress }}<br>
          {{ selectedOrder.city }}, {{ selectedOrder.zipCode }}
        </div>
      </div>
      <div class="col-12 md:col-6" *ngIf="selectedOrder.payment">
        <h4 class="section-title">Payment Details</h4>
        <div class="payment-box">
          <div class="detail-item">
            <span class="label">Method</span>
            <span class="value">{{ selectedOrder.payment.paymentMethod }}</span>
          </div>
          <div class="detail-item" *ngIf="selectedOrder.payment.transactionId">
            <span class="label">Transaction ID</span>
            <span class="value">{{ selectedOrder.payment.transactionId }}</span>
          </div>
        </div>
      </div>
    </div>

    <h4 class="section-title mt-4">Order Items</h4>
    <div class="order-items-list">
      <div *ngFor="let item of selectedOrder.items" class="order-item">
        <img [src]="imageUrls[item.productId]" (error)="handleImageError($event)" [alt]="item.productName" class="item-image">
        <div class="item-details">
          <span class="item-name">{{ item.productName }}</span>
          <span class="item-qty-price">{{ item.quantity }} x {{ item.unitPrice | currency:'INR' }}</span>
        </div>
        <div class="item-subtotal">
          {{ item.subtotal | currency:'INR' }}
        </div>
      </div>
    </div>

    <p-divider layout="horizontal"></p-divider>

    <div class="order-total">
      <span class="label">Total Amount</span>
      <span class="total-value">{{ selectedOrder.totalAmount | currency:'INR' }}</span>
    </div>
  </div>
</p-dialog>
